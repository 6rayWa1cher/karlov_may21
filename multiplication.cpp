#include <iostream>
#include "number.h"
#include "utils.h"

uint8_t multiplicationTable[10][10] = {
        {0, 0, 0,  0,  0,  0,  0,  0,  0,  0},
        {0, 1, 2,  3,  4,  5,  6,  7,  8,  9},
        {0, 2, 4,  6,  8,  10, 12, 14, 16, 18},
        {0, 3, 6,  9,  12, 15, 18, 21, 24, 27},
        {0, 4, 8,  12, 16, 20, 24, 28, 32, 36},
        {0, 5, 10, 15, 20, 25, 30, 35, 40, 45},
        {0, 6, 12, 18, 24, 30, 36, 42, 48, 54},
        {0, 7, 14, 21, 28, 35, 42, 49, 56, 63},
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 72},
        {0, 9, 18, 27, 36, 45, 54, 63, 72, 81}
};

uint8_t modTable[256] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1,
                         2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3,
                         4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5,
                         6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7,
                         8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                         0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1,
                         2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3,
                         4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4,
                         5};

uint8_t divTable[256] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3,
                         3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6,
                         6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9,
                         9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12,
                         12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14,
                         14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                         16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19,
                         19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21,
                         21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24,
                         24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25};

Number columnMultiply(const Number &a, const Number &b) {
    Number x, y;
    if (a.getN() < b.getN()) {
        x = b;
        y = a;
    } else {
        x = a;
        y = b;
    }

    uint32_t xSize = x.getN(), ySize = y.getN();
    uint32_t size = xSize + ySize;
    const Array &xArr = x.getArray();
    const Array &yArr = y.getArray();

    auto* array = new uint8_t[size];
    for (size_t i = 0; i < size; ++i) array[i] = 0;

    uint8_t upperPart, lowerPart, resultPart, carry;
    for (uint32_t i = 0; i < ySize; ++i) {
        lowerPart = yArr[i];
        carry = 0;
        for (size_t j = 0; j < xSize; ++j) {
            upperPart = xArr[j];
            resultPart = multiplicationTable[lowerPart][upperPart]
                         + carry + array[j + i];
            carry = divTable[resultPart];
            array[j + i] = modTable[resultPart];
        }
        if (carry != 0) {
            array[xSize + i] = carry;
        }
    }

    size_t newSize = eraseEndingZeroes(size, array);
    Array arr(newSize, array);
    Number n(x.isNegative() ^ y.isNegative(), arr);
    delete[] array;
    std::cout << n << std::endl;
    return n;
}